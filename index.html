<!DOCTYPE html>
<html lang="pt-br">
<head>
	<meta charset="utf-8" />
	<title>BR Modelo</title>

	<!-- CSS -->
	<link rel="stylesheet" media="screen" href="css/reset.css">
	<link rel="stylesheet" media="screen" href="css/styles.css">
	<link rel="stylesheet" media="screen" href="css/effects.css">
	<link rel="stylesheet" media="screen" href="css/joint.css">
	<link rel="stylesheet" media="screen" href="css/fontAwesome/font-awesome.css">
	

	<!-- Scripts -->
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	<script type="text/javascript" src="resource/js/cssua.min.js"></script>

	<!-- Web Fonts -->
	<link href='http://fonts.googleapis.com/css?family=Lato:100,100italic,light,lightitalic,regular,regularitalic,bold,bolditalic,900,900italic' rel='stylesheet' type='text/css'>

	<!-- iPhone -->
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
    <script src="js/joint.js"></script>
    <script src="js/joint.shapes.erd.js"></script>

	<!--[if lte IE 8]>
	<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
</head>
<body>
	<header class="mainHeader cf">
		<h1><a href="#">BR Modelo</a></h1>
		<nav>
			<a href="#">Como Funciona</a>
			<a href="#">Sobre</a>
			<a href="#">Contato</a>
		</nav>
		<aside class="userInfo">
			<img src="imgs/user.jpg" alt="Milton" />
			<div class="options">
				<a href="#">Perfil</a>
				<a href="#">Logout</a>
			</div> <!-- End .options -->
		</aside> <!-- End .userInfo -->
	</header> <!-- End .mainHeader -->

	<section class="content cf">
		<nav class="modelList">
			<ul>
				<li><a href="#">Base de dados para AWS</a></li>
				<li><a href="#">Banco genérico usando MySQL</a></li>
				<li class="active"><a href="#">World domination project</a></li>
				<li><a href="#">Mais alguma modelagem</a></li>
				<li class="newModel"><a href="#"><i class="fa fa-plus"></i></a></li>
			</ul>
		</nav>
		<section class="visibleModel" id="content">
			<header>
				<h2>Nome do Model</h2>
				<aside class="zoom">
					<span class="button" href="#"><i class="fa fa-search-plus"></i></span>
					<span class="button" href="#"><i class="fa fa-search-minus"></i></span>
				</aside>
			</header>
			<div class="theModel" id="myholder"></div> <!-- End .theModel -->
			<footer>
				<ul class="modelElements cf">
					<li id="entityclick"><img src="imgs/icon/rectangle.png"/></li>
					<li id="relationclick"><img src="imgs/icon/rhombus.png"/></li>
					<li id="atributoclick"><img src="imgs/icon/atributo.png"/></li>
					<li id="atributochaveclick"><img src="imgs/icon/atributo_identificador.png"/></li>
					<li id="lineclick"><img src="imgs/icon/connect.png"/></li>
				</ul> <!-- End ul.modelElements -->
				<aside class="shareOptions">
					<i class="fa fa-share-square-o"><span>Compartilhar</span></i>
					<ul>
						<li><i class="fa fa-facebook"><span>Facebook</span></i></li>
						<li><i class="fa fa-twitter"><span>Twitter</span></i></li>
						<li><i class="fa fa-google-plus"><span>Email</span></i></li>
						<li><i class="fa fa-envelope-o"><span>Email</span></i></li>
					</ul>
				</aside>
			</footer>
		</section> <!-- End .visibleModel -->
	</section> <!-- End .content -->
</body>

         <script>
        

         var graph = new joint.dia.Graph;

         console.log($('#content').width());
         console.log($('#content').height());
         
         var paper = new joint.dia.Paper({
             el: $('#myholder'),
             width: $('#content').width(),
             height: $('#content').height(),
             gridSize: 1,
             model: graph
         });

         var erd = joint.shapes.erd;

         var element = function(elm, x, y, label) {
             var cell = new elm({ position: { x: x, y: y }, attrs: { text: { text: label }}});
             
             graph.addCell(cell);
                          
          		return cell;
          
             }; 

         var link = function(elm1, elm2) {
             var myLink = new erd.Line({ source: { id: elm1.id }, target: { id: elm2.id }});
             graph.addCell(myLink);
             return myLink;
         };

         var filial = element(erd.Entity, 90, 43, "FILIAL");       
         
         var possui = element(erd.IdentifyingRelationship, 345, 33, "possui");              
         var cliente = element(erd.Entity, 532, 45, "CLIENTE");    
         var isa = element(erd.ISA, 559, 151, "");              
         var pfisica = element(erd.Entity, 423, 254, "PESSOA FÍSICA");                  
         var pjuridica = element(erd.Entity, 653, 258, "PESSOA JURÍDICA");  
                       
         var nome = element(erd.Key, 713, 30, "código");
         var codcliente = element(erd.Normal, 711, 57, "cliente");  
                       
         var sexo = element(erd.Normal, 467, 335, "rg");
         var rg = element(erd.Normal, 326, 334, "cpf");  
                       
         var cnpj = element(erd.Normal, 783, 239, "cnpj");  
             
         link(filial, possui).cardinality('1..1');              
         link(cliente, possui).cardinality('0..n'); 
                       
         link(cliente, isa);              
         link(pfisica, isa); 
         link(pjuridica, isa); 
                       
         link(cliente, nome);  
         link(cliente, codcliente);
                       
         link(pfisica, sexo);  
         link(pfisica, rg);
                       
         link(pjuridica, cnpj);
         
         $("#entityclick").click(function() {
        	 element(erd.Entity, 50, 350, "ENTIDADE");
         });
         
         $("#relationclick").click(function() {
        	 element(erd.IdentifyingRelationship, 50, 350, "Relacionamento");
         });

         $("#atributoclick").click(function() {
        	 element(erd.Normal, 50, 350, "ENTIDADE");
         });
         
         $("#atributochaveclick").click(function() {
        	 element(erd.Key, 50, 350, "ENTIDADE");
         });
         
         $("#lineclick").click(function() {
 
        	 var link;

        	 link = new joint.dia.Link({
        	   source: {
        	     x: 50,
        	     y: 500
        	   },
        	   target: {
        	     x: 50,
        	     y: 350
        	   },
        	   attrs: {}
        	 });

        	 link.attr({
        	   ".connection": {
        	     stroke: "black"
        	   }
        	 });
        	 
        	 
        	 graph.addCell(link);
        	 
         });
         
         var x = 1;
         
         $("#lessclick").click(function() {
        	 x = x - 0.1;
        	 paper.scale(x, x);
        	 
         });
         
         $("#moreclick").click(function() {
        	 x = x + 0.1;
        	 paper.scale(x, x);
         });
         
         this.paper.on( "cell:pointerdown", function( cellview, evt, x, y)  {
        	 
        	 console.log(evt.originalEvent.altKey);
        	 
        	 if(evt.originalEvent.altKey == true){
        		 
        		   if(cellview.model.attributes.attrs.rect.fill == 'blue'){
                  	 cellview.model.attributes.attrs.rect.fill = 'white'; 
                   } else {
                  	 cellview.model.attributes.attrs.rect.fill = 'blue'
                   }

                   var jsonString = JSON.stringify(graph.toJSON());
                	
                   graph.clear();
                   
                   graph.fromJSON(JSON.parse(jsonString));
        		 
        	 }
        	 
/*           console.log( "pointer down on cell ", cellview.model.id, " pos: ", x , ",", y);
             
             
             
           */
             
         });
         
           </script>

</html>